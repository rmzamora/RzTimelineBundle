{% extends sonata_block.templates.block_base %}

{% block block %}
    <div class="box box-color box-bordered green">
        <div class="box-title">
            <h3>
                <i class="icon-table"></i>
                {% if settings.title %}<h3>{{ settings.title }}</h3>{% endif %}
            </h3>
        </div>
        <div class="box-content">
            <ul class="timeline">
                {% for entry in entries %}

                    {% if currentDay is not defined or currentDay != entry.createdAt|format_date %}
                        {% set currentDay = entry.createdAt|format_date %}
                        <li class="time-label">
                            <span class="bg-red">{{ currentDay }}</span>
                        </li>
                    {% endif %}

                    {% set subject = entry.getComponent('subject') %}
                    {% set target = entry.getComponent('target') %}
                    {% set target_text_component = entry.getComponent('target_text') %}

                    {% if subject.data %}
                        {% set subject_text = sonata_timeline_generate_link(subject) %}
                    {% else %}
                        {% set subject_text = '<abbr title="reference: ' ~  subject.hash ~ '">element deleted</abbr>' %}
                    {% endif %}

                    {% if target.data is defined and target.data is not empty %}
                        {% set target_text = sonata_timeline_generate_link(target) %}
                    {% elseif target_text_component %}
                        {% set target_text = '<abbr title="Element Deleted">'~target_text_component~'</abbr>' %}
                    {% else %}
                        {% set target_text = '<abbr title="reference: ' ~  target.hash ~ '">element deleted</abbr>' %}
                    {% endif %}

                    {% set verb = "actions."~entry.verb %}
                    {% set icon = "actions.icon."~entry.verb %}

                    <li>
                        <i class="{{ icon|trans({}, "SonataTimelineBundle") }}"></i>
                        <div class="timeline-item" style="background: #f3f4f5;">
                            <span class="time"><i class="fa fa-clock-o"></i> {{ entry.createdAt|format_time }}</span>
                            <p class="timeline-header" style="border-bottom: none;">{{ verb|trans({'%subject%': subject_text, '%target%': target_text}, "SonataTimelineBundle")|raw }}</p>
                        </div>
                    </li>
                {% else %}
                    No action for now ...
                {% endfor %}
            </ul>
        </div>
    </div>
{% endblock %}
